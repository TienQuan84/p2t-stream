<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Sony A74 to RTMP Bridge</title>
    <style>
        body { font-family: sans-serif; background: #121212; color: white; text-align: center; }
        video { width: 80%; border: 2px solid #00ff44; border-radius: 10px; margin-top: 20px; }
        .status { margin: 20px; font-size: 20px; font-weight: bold; }
        .live { color: #00ff44; }
        .stop { color: #ff4444; }
    </style>
</head>
<body>
    <h2>Sony A7 IV - RTMP Streamer</h2>
    <video id="preview" autoplay playsinline muted></video>
    <div class="status" id="status">CH∆ØA K·∫æT N·ªêI</div>
    
    <button id="startBtn" style="padding: 15px 30px; cursor: pointer;">B·∫ÆT ƒê·∫¶U STREAM RTMP</button>

    <script>
        const video = document.getElementById('preview');
        const status = document.getElementById('status');
        const startBtn = document.getElementById('startBtn');
        let mediaRecorder;
        let socket;

        // 1. L·∫•y h√¨nh ·∫£nh t·ª´ Sony A7 IV
        async function initCamera() {
            const stream = await navigator.mediaDevices.getUserMedia({
                video: { 
                    width: { ideal: 1920 }, 
                    height: { ideal: 1080 },
                    frameRate: { ideal: 30 }
                },
                audio: true
            });
            video.srcObject = stream;
            return stream;
        }

        startBtn.onclick = async () => {
            const stream = await initCamera();
            
            // 2. K·∫øt n·ªëi t·ªõi Server x·ª≠ l√Ω RTMP (thay localhost b·∫±ng IP server c·ªßa b·∫°n)
            socket = new WebSocket('ws://localhost:3000');

            socket.onopen = () => {
                status.innerText = "üî¥ ƒêANG LIVE (RTMP)";
                status.className = "status live";
                
                // 3. C·∫•u h√¨nh MediaRecorder ƒë·ªÉ ghi video HD
                mediaRecorder = new MediaRecorder(stream, {
                    mimeType: 'video/webm; codecs=vp8',
                    videoBitsPerSecond: 5000000 // 5Mbps cho Full HD
                });

                mediaRecorder.ondataavailable = (e) => {
                    if (e.data.size > 0) socket.send(e.data);
                };

                mediaRecorder.start(100); // G·ª≠i d·ªØ li·ªáu m·ªói 100ms
            };

            socket.onclose = () => {
                status.innerText = "ƒê√É NG·∫ÆT K·∫æT N·ªêI";
                status.className = "status stop";
            };
        };
    </script>
</body>
</html>
